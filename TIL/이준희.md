# TIL(Today I Learn) :fire:

### 2025.01.14

#### 한 일
- 역할 분담
- 릴리즈 날짜 정하기
- ERD 완성

#### 해야 할 일
- 웹소켓 로직 생각해보기
- 프로젝트 세팅하기

### 공부한 것

#### 웹 소켓 연결 과정(간단)

1. A 클라이언트가 서버로 자신의 정보를 보낸다
2. B 클라이언트도 서버로 자신의 정보를 보낸다
3. 둘 다 있을 때, A가 B로 연결 요청을 보낸다
    1. A → 서버로 offer (이 때, 타겟인 B의 아이디 필요)
    2. B → 서버로 answer (이 때, A의 아이디 필요)
    3. A → 서버로 ice-머시기 보냄
    4. B도 보냄
4. 연결 완료!

#### 실제 우리 로직에서는 어떻게 동작할까?

(가정) A와 B가 스페셜 초콜릿을 주고 받았다

 → A가 B에게 줌. 시간은 2시.

1. 1시 55분에 알림 전송(이 때, 별도의 회의실 등의 구축 불필요)
    a. A와 B에게 모두 전송
2. A가 먼저 들어온다고 가정 → session_list에 A의 세션 정보가 추가
    b. 이 때, B가 들어와있는지 체크(별도의 요청 필요)

3-1 . 안들어와있으면, 대기 → 상대방이 안들어와있다는 메시지를 내려줌

3-2. 들어와있으면(위의 체크 상황에서 들어와있다는 메시지를 내려줬으면)

4. 늦게 들어온 사람(A)이 들어와있던 사람에게 offer, B가 A에게 answer, 그 뒤에 ice ~보낸 뒤 연결


### 2025.01.15

#### 한 일
- 기획 고도화
- 어떻게 하면 우리 서비스를 더 들어오게 만들까..?

-> 기존의 힌트 방식 제거 후 미리 까보기 방식 채택

### 공부한 것
#### 채팅 시스템 설계

- 1:1 채팅만 지원 ⇒ 대신 양방향으로 매칭 되면 만들어주기
- 알림까지 하기에는 무리
    - 다른 방법 생각
- 그렇다면 그냥 실시간 채팅만이라도 가져가자
    - 웹소켓
- 데이터베이스 ⇒ NoSQL
    - **키/값 저장소는 수평적 규모 확장이 쉽다.**
    - **키/값 저장소는 데이터 접근 지연시간(latency)가 낮다.**
    - 관계형 데이터베이스는 롱 테일(long tail)에 해당하는 부분을 잘 처리하지 못하는 경향이 있다. 인덱스가 커지면 데이터에 대한 무작위적 접근(random access)를 처리하는 비용이 늘어난다. → 우리는 채팅 내용에서 언급을 찾거나, 특정 메세지를 검색하는 기능은 없기 때문에 이 점은 고려하지 않아도 됨
    - 페이스북 메신저는 HBase를 사용하고 디스코드는 카산드라 NoSQL을 사용하고 있다.
    - 해당 서비스들은 60억건의 채팅 <-> 우리 서비스는 그렇게까지 많지 않을 것 같은데 RDB로도 되지 않을까..?
    - 고민해봐야 함
- 채팅 서버 / API 서버 따로 두기
- 메세지큐 → 카프카 예정


### 2025.01.16

#### 한 일
- Entity 작성
- 프로젝트 구조 설계 후 설정

#### 공부한 것
- openvidu를 사용할 예정인데, 5초 카운트와 연결시 1분 세팅은 어떻게 할까?
- openvidu api 문서를 보니, 우리 백엔드 서버로 hook을 날려 알려줄 수 있다.
- 이걸 활용하여 RTC 상대 검증과 방 입장을 해결할 수 있을 것 같다.

### 2025.01.17

#### 한 일
- 전체 선물 조회 api 완성
- 코딩 컨벤션 수정 & 확정정
